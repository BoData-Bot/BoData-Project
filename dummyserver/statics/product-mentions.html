<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>SB Admin - Start Bootstrap Template</title>
    <!-- Bootstrap core CSS-->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom fonts for this template-->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- Custom styles for this template-->
    <link href="css/sb-admin.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


    <style>

        .space-filler {
            height : 50px;
        }

        .container-eric {
            width: 80%;
            margin: 15px auto;
        }

        fieldset.date {
            margin: 0;
            padding: 0;
            padding-left: 20px;
            padding-bottom: .5em;
            display: block;
            border: none;
        }

        fieldset.date legend {
            margin: 0;
            padding: 0;
            margin-top: .25em;
            font-size: 100%;
        }


        fieldset.date label {
            position: absolute;
            top: -20em;
            left: -200em;
        }

        fieldset.date select {
            margin: 0;
            padding: 0;
            font-size: 100%;
            display: inline;
        }

        span.inst {
            font-size: 75%;
            color: blue;
            padding-left: .25em;
        }


        fieldset.date select:active,
        fieldset.date select:focus,
        fieldset.date select:hover
        {
            border-color: gray;
            background-color: lightyellow;
        }

    </style>

</head>

<body class="fixed-nav sticky-footer bg-dark" id="page-top">
<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href="index.html">boData</a>

    <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">

            <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Charts">
                <a class="nav-link" href="product-mentions.html">
                    <i class="fa fa-fw fa-area-chart"></i>
                    <span class="nav-link-text">Product Mentions</span>
                </a>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
                <a class="nav-link" href="product-sentiment.html">
                    <i class="fa fa-fw fa-table"></i>
                    <span class="nav-link-text">Sentiment Analysis</span>
                </a>
            </li>

        </ul>
        <ul class="navbar-nav sidenav-toggler">
            <li class="nav-item">
                <a class="nav-link text-center" id="sidenavToggler">
                    <i class="fa fa-fw fa-angle-left"></i>
                </a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" data-toggle="modal" data-target="#exampleModal">
                    <i class="fa fa-fw fa-sign-out"></i>Logout</a>
            </li>
        </ul>
    </div>
</nav>
<div class="content-wrapper">
    <div class="container-eric">
        <div class = "row">

            <div class="col-md-3" text="Product">

                <h3>Product</h3>
                <Select id="product-select1">
                    <option selected="selected">Dr. Pepper</option>
                    <option>7UP</option>
                    <option>None</option>
                </Select>
                <!--<label for="month_start">Month</label>-->
                <!--<select id="month_start"-->
                <!--name="month_start" />-->

                <div class="space-filler"></div>

                <Select id="product-select2">
                    <option>Dr. Pepper</option>
                    <option>7UP</option>
                    <option selected="selected">None</option>
                </Select>

            </div>

            <div class="col-md-5" text="Location">

                <h3>Location</h3>
                <Select id="location-select1">
                    <option selected="selected">Mumbai</option>
                    <option>Bangkok</option>
                    <option>None</option>
                </Select>

                <div class="space-filler"></div>

                <Select id="location-select2">
                    <option>Mumbai</option>
                    <option>Bangkok</option>
                    <option selected="selected">None</option>
                </Select>

            </div>
            <div>
                <fieldset class="date">
                    <h3>Start Date </h3>
                    <label for="month_start">Month</label>
                    <select id="month_start"
                            name="month_start" />
                    <option selected="selected">01</option>
                    <option>02</option>
                    <option>03</option>
                    <option>04</option>
                    <option>05</option>
                    <option>06</option>
                    <option>07</option>
                    <option>08</option>
                    <option>09</option>
                    <option>10</option>
                    <option>11</option>
                    <option>12</option>
                    </option>
                    </select> -
                    <label for="day_start">Day</label>
                    <select id="day_start"
                            name="day_start" />
                    <option selected="selected">1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                    <option>11</option>
                    <option>12</option>
                    <option>13</option>
                    <option>14</option>
                    <option>15</option>
                    <option>16</option>
                    <option>17</option>
                    <option>18</option>
                    <option>19</option>
                    <option>20</option>
                    <option>21</option>
                    <option>22</option>
                    <option>23</option>
                    <option>24</option>
                    <option>25</option>
                    <option>26</option>
                    <option>27</option>
                    <option>28</option>
                    <option>29</option>
                    <option>30</option>
                    <option>31</option>
                    </option>
                    </select> -
                    <label for="year_start">Year</label>
                    <select id="year_start"
                            name="year_start" />
                    <option>2009</option>
                    <option>2010</option>
                    <option>2011</option>
                    <option>2012</option>
                    <option>2013</option>
                    <option>2014</option>
                    <option>2015</option>
                    <option>2016</option>
                    <option selected="selected">2017</option>
                    <option>2018</option>
                    </option>
                    </select>
                    <span class="inst"></span>
                </fieldset>

                <fieldset class="date">
                    <h3>End Date </h3>
                    <label for="month_end">Month</label>
                    <select id="month_end"
                            name="month_end" />
                    <option>01</option>
                    <option>02</option>
                    <option>03</option>
                    <option>04</option>
                    <option>05</option>
                    <option>06</option>
                    <option>07</option>
                    <option>08</option>
                    <option>09</option>
                    <option>10</option>
                    <option>11</option>
                    <option selected="selected">12</option>
                    </option>
                    </select> -
                    <label for="day_end">Day</label>
                    <select id="day_end"
                            name="day_end" />
                    <option selected="selected">1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                    <option>7</option>
                    <option>8</option>
                    <option>9</option>
                    <option>10</option>
                    <option>11</option>
                    <option>12</option>
                    <option>13</option>
                    <option>14</option>
                    <option>15</option>
                    <option>16</option>
                    <option>17</option>
                    <option>18</option>
                    <option>19</option>
                    <option>20</option>
                    <option>21</option>
                    <option>22</option>
                    <option>23</option>
                    <option>24</option>
                    <option>25</option>
                    <option>26</option>
                    <option>27</option>
                    <option>28</option>
                    <option>29</option>
                    <option>30</option>
                    <option selected="selected">31</option>
                    </option>
                    </select> -
                    <label for="year_end">Year</label>
                    <select id="year_end"
                            name="year_end" />
                    <option>2009</option>
                    <option>2010</option>
                    <option>2011</option>
                    <option>2012</option>
                    <option>2013</option>
                    <option>2014</option>
                    <option>2015</option>
                    <option>2016</option>
                    <option selected="selected">2017</option>
                    <option>2018</option>
                    </option>
                    </select>
                    <span class="inst"></span>
                </fieldset>

                <div class="col-md-3">
                    <button id="update-button" type="button" onclick="refreshData()">Update
                    </button>
                </div>

            </div>
        </div>   <!--  end row div   -->

        <!-- Area Chart Example-->
        <br><br><br>
        <div class="row">

            <div class = "col-md-12">
                <canvas id="productMentions"></canvas>
            </div>
        </div>

    </div>

    <!-- /.content-wrapper-->
    <footer class="sticky-footer">
        <div class="container">
            <div class="text-center">
                <small>Cornell Tech 2017</small>
            </div>
        </div>
    </footer>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fa fa-angle-up"></i>
    </a>
    <!-- Logout Modal-->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap core JavaScript-->
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Page level plugin JavaScript-->
    <script src="vendor/chart.js/Chart.min.js"></script>
    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin.min.js"></script>
    <!-- Custom scripts for this page-->
    <script src="js/sb-admin-charts.min.js"></script>


    <script>

        // global variables
        var beginDate = "2017-01-01";  // don't need this anymore, just POST request the whole year
        var endDate = "2017-12-31";

        var m_start;  // string version
        var m_end;  // string version

        var bothMonthlyTotals = [];  // array of arrays

        var productName1;
        var productName2;

        var locationSelected1;
        var locationSelected2;

        var productLoc1;
        var productLoc2;

        // global variables, bad practice I know...
        var firstGraphMade = false;
        var productMentionsGraph;
        var labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];



        //   -----       at start, grabTextData, send new request, make graph   -----   //
        $(document).ready(function(){
//            refreshData();
//            makePost();
        })

        // grab updated text values from drop down selections
        function refreshData() {

            // for product 1
            productName1 = $("#product-select1 option:selected").text();
            locationSelected1 = $("#location-select1 option:selected").text();
            productLoc1 = "[['" + productName1 + "']," + "['" + locationSelected1 + "']]";

            // for product 2
            productName2 = $("#product-select2 option:selected").text();
            locationSelected2 = $("#location-select2 option:selected").text();
            productLoc2 = "[['" + productName2 + "']," + "['" + locationSelected2 + "']]";

            // dates for both products
            var y_start = $("#year_start option:selected").text();
            m_start = $("#month_start option:selected").text();
            var d_start = $("#day_start option:selected").text();

            var y_end = $("#year_end option:selected").text();
            m_end = $("#month_end option:selected").text();
            var d_end = $("#day_end option:selected").text();

            console.log(productLoc1);
            console.log(productLoc2);

            // makes post request for both products
            makePost();

//            console.log("the monthly total is: " + monthlyTotal1);

        };  // end refresh()

        // send new POST request for mentions
        function makePost() {

            bothMonthlyTotals = [];  // reset the monthly totals array

            var monthlyTotal1 = [];
            var monthlyTotal2 = [];

            var daysByMonth2017 = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            var cummulativeStartIndex = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            var cummulativeEndIndex = [31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];
            var month2017 = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'June', 'July', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            // makes first POST request
            $.post("http://localhost:5000/getmentionsfigure",
                {
                    begin: beginDate,
                    end: endDate,
                    products: productLoc1
                },
                function (data, status) {  // success function to create a monthly values array
                    data = eval(data); // convert to array

                    mStart = parseInt(m_start) - 1;  // convert to int
                    mEnd = parseInt(m_end) - 1;  // convert to int

                    var xAxisLength = mEnd - mStart + 1;  // get number of entries (size of array to expect)
                    var totalMentions = 0;
                    var startIndex = cummulativeStartIndex[mStart];

                    for (month = 0; month < 12; month++) {  // for all the months
                        var tempTotal = 0;
                        var start = 0;

                        for (day = cummulativeStartIndex[month]; day < cummulativeEndIndex[month]; day++) {
                            tempTotal += data[day];
                        }
                        monthlyTotal1.push(tempTotal);
//                        console.log("the before monthly total is: " + monthlyTotal);
                    }  // end for loop

                    bothMonthlyTotals.push(monthlyTotal1);
                }  // end post
            )  // end success function



            //  ----------------------  //


            // make second POST request for other product
            $.post("http://localhost:5000/getmentionsfigure",
                {
                    begin: beginDate,
                    end: endDate,
                    products: productLoc2
                },
                function (data, status) {  // success function to create a monthly values array
                    data = eval(data); // convert to array

                    mStart = parseInt(m_start) - 1;  // convert to int
                    mEnd = parseInt(m_end) - 1;  // convert to int

                    var xAxisLength = mEnd - mStart + 1;  // get number of entries (size of array to expect)
                    var totalMentions = 0;
                    var startIndex = cummulativeStartIndex[mStart];

                    for (month = 0; month < 12; month++) {  // for all the months
                        var tempTotal = 0;
                        var start = 0;

                        for (day = cummulativeStartIndex[month]; day < cummulativeEndIndex[month]; day++) {
                            tempTotal += data[day];
                        }
                        monthlyTotal2.push(tempTotal);
//                        console.log("the before monthly total is: " + monthlyTotal2);
                    }  // end for loop

                    bothMonthlyTotals.push(monthlyTotal2);

                    // to handle asychronous calling
                    if(bothMonthlyTotals.length == 2) {
                        console.log(bothMonthlyTotals[0]);
                        makeGraph(bothMonthlyTotals);
                    }
                }  // end post
            )  // end success function
        };  // end makePost function


        //  make the graph for 2 products
        function makeGraph(bothMonthlyTotals) {
            // bothMonthlyTotals = size 2 array of monthly totals for 2 productss

            var productLabel2;

            // chart color values
            var clearBorderColor = '#ffffff';
            var clearBackgroundColor = "rgba(220,53,69,0)";

            var redBorderColor = '#dc3545';
            var redBackgroundColor = 'rgba(220,53,69,0.2)';

            // colors for product 2 selected (default)
//            var product2background = redBackgroundColor;
//            var product2border = redBorderColor;

            var titleDisplayText;

            console.log("product 2 name: " + productName2);
//            console.log(bothMonthlyTotals[0]);

            // if product is selected None, then change all the colors for product 2 to be clear
            if(productName2 != 'None') {
                product2background = redBackgroundColor;
                product2border = redBorderColor;
                titleDisplayText = productName1 + ' in ' + locationSelected1 + ' and ' + productName2 + ' in ' + locationSelected2;
                productLabel2 = productName2;
            }

            else {
                product2background = clearBackgroundColor;
                product2border = clearBorderColor;
                titleDisplayText = productName1 + ' in ' + locationSelected1;
                productLabel2 = ' ';
            }

            mStartIndex = parseInt(m_start) - 1;  // convert to int
            mEndIndex = parseInt(m_end) - 1;  // convert to int

            monthlyTotal1 = bothMonthlyTotals[0].slice(mStartIndex,mEndIndex+1);
            monthlyTotal2 = bothMonthlyTotals[1].slice(mStartIndex,mEndIndex+1);

            // adjust the labels
            newLabels = labels.slice(mStartIndex,mEndIndex+1);

//            // make the graph
            var ctx = document.getElementById('productMentions').getContext('2d');

            // if not the first graph, make a new one
            if(!firstGraphMade) {

                productMentionsGraph = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: newLabels,
                        datasets: [{
                            label: productName1,
                            data: monthlyTotal1,
                            backgroundColor: "rgba(0,123,255,.2)",
                            borderColor: "#007bff",
                            borderDash: [5, 5]
                        }, {
                            label: productLabel2,
                            data: monthlyTotal2,
                            backgroundColor: product2background,
                            borderColor: product2border,
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        title: {
                            display: true,
                            text: titleDisplayText
                        }
                    }
                });  // end making graph

                firstGraphMade = true;
            }

            // else a graph exists, destroy it first
            else {
                productMentionsGraph.destroy();

                productMentionsGraph = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: newLabels,
                        datasets: [{
                            label: productName1,
                            data: monthlyTotal1,
                            backgroundColor: "rgba(0,123,255,.2)",
                            borderColor: "#007bff",
                            borderDash: [5, 5]
                        }, {
                            label: productLabel2,
                            data: monthlyTotal2,
                            backgroundColor: product2background,
                            borderColor: product2border,
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        title: {
                            display: true,
                            text: titleDisplayText
                        }
                    }
                });  // end making graph
            }   // end else
        }  // end makeGraph()

    </script>

</div>
</body>

</html>